<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Extension</title>
    <style>
        body{
            font-size: 40px;
            line-height: 1.3;
        }
        .fps_draw{
            position: fixed;
            z-index: 9999;
            top: 0px;
            right: 0px;
            background: linear-gradient(rgba(0,255,132,1) 0%, rgba(0,128,128,1) 100%);
            /*border-radius: 5px;*/
            border-bottom-left-radius: 5px;
            border-left: 2px solid white;
            border-bottom: 2px solid white;
            box-shadow: -5px 4px 16px 0px rgba(50, 50, 50, 0.77);
            overflow: hidden;
            display: none;
        }
        .fps_draw.is_visible{
            display: block;
        }
    </style>
</head>
<body>
    <div>
        <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus aliquid at consectetur cupiditate
            debitis deleniti eius et explicabo facere incidunt magnam nesciunt optio, pariatur quod ratione tempore
            ullam velit voluptatibus.
        </div>
        <div>A ab alias asperiores assumenda atque consectetur consequuntur cum cumque eaque, earum eum placeat possimus
            provident quaerat quam quas quia quisquam reiciendis, rerum tempora tempore, veritatis vero voluptatibus.
            Ad, architecto?
        </div>
        <div>A ad animi architecto, asperiores atque consectetur culpa distinctio doloremque eos eum excepturi facilis
            harum id ipsum iure molestiae mollitia nam nesciunt possimus quia repellat repellendus sapiente tempore ut
            voluptatem!
        </div>
        <div>Atque eius exercitationem facere non temporibus. Dolor dolore minus nulla? Deleniti dicta dolor dolorem
            facilis hic id labore maiores officia, officiis praesentium quam quod reiciendis saepe sint soluta, unde
            voluptates!
        </div>
        <div>Cumque fugit harum nam necessitatibus nulla? Ab animi architecto assumenda commodi debitis deleniti,
            deserunt ex explicabo fugit laboriosam mollitia natus numquam obcaecati odio odit, quod sapiente similique
            vel voluptatem, voluptatibus.
        </div>
        <div>Cumque eligendi esse maxime odit ut. Consequuntur corporis dolor exercitationem fuga impedit, inventore
            iste iure laboriosam magnam numquam obcaecati pariatur provident quidem rem, sint sunt veniam voluptate.
            Beatae dolore, nihil?
        </div>
        <div>Adipisci alias asperiores cum fugit inventore libero minus, natus nesciunt nulla perferendis placeat
            provident ratione soluta. Nobis sint ullam vitae. Aut beatae, voluptatibus! Cumque illum, magnam magni
            mollitia odio perspiciatis.
        </div>
        <div>Accusamus accusantium ad amet blanditiis cum debitis dolor eligendi, facere, illo impedit laboriosam nam
            nisi nulla perferendis perspiciatis quasi reprehenderit repudiandae rerum soluta, tempora? Facere fugit
            ipsam perferendis reiciendis velit!
        </div>
        <div>Commodi consequuntur culpa dignissimos dolor dolorem eligendi hic, impedit incidunt ipsum laborum
            laudantium necessitatibus nemo nesciunt nostrum numquam obcaecati, officiis perferendis quidem reiciendis
            repellendus, reprehenderit saepe sit soluta vero voluptates.
        </div>
        <div>Alias, aspernatur dolor dolorem doloremque eaque eius enim error esse hic id illum maiores modi natus odit
            officia optio quam quidem quis, recusandae rem reprehenderit temporibus tenetur ullam ut veritatis.
        </div>
        <div>Accusamus adipisci commodi cumque eum fugiat illo in incidunt inventore ipsum non, possimus qui quibusdam
            repellat. Beatae illum ipsa perspiciatis quaerat sapiente sed voluptatibus voluptatum! Aperiam asperiores
            explicabo vitae! Pariatur.
        </div>
        <div>Aspernatur consequatur, doloribus eos est fuga itaque numquam officiis placeat quas quia soluta veritatis
            voluptate. Aut consectetur culpa dolores esse et facilis inventore maiores molestias nulla obcaecati,
            quidem, veritatis vitae.
        </div>
        <div>Beatae earum perferendis vero. Aliquid atque aut cumque eligendi enim inventore laudantium, magni maiores,
            nam nemo neque nulla optio porro possimus quibusdam soluta suscipit tempora tenetur unde ut voluptate
            voluptatem.
        </div>
        <div>Ad fuga labore neque nobis officia quas quos repellat sed similique tempore. Ab asperiores assumenda culpa
            cumque, deleniti dolores facere incidunt ipsam, laborum nobis nulla pariatur, quos repellendus sunt
            voluptatum.
        </div>
        <div>Cum doloremque enim eum necessitatibus nulla optio quia ratione? Assumenda culpa cumque exercitationem in,
            incidunt iste pariatur recusandae. Amet atque, consectetur ex id in repudiandae sunt unde? Blanditiis,
            dolor, expedita.
        </div>
        <div>Debitis delectus dolorem, exercitationem fugiat molestiae pariatur porro quae quibusdam tempore
            voluptatibus. Adipisci, alias aperiam, architecto blanditiis cupiditate doloribus labore perferendis
            possimus, sit tempora temporibus voluptatem? Aspernatur deleniti error ex!
        </div>
        <div>A aliquid, amet asperiores aut blanditiis delectus dolorum magni minima modi, nihil nisi officia
            perferendis perspiciatis quaerat qui quibusdam quidem quisquam recusandae repellat reprehenderit suscipit
            totam ullam vel vero, voluptatum.
        </div>
        <div>Accusamus dolorum exercitationem, fuga harum modi pariatur reprehenderit tenetur. Accusamus aspernatur
            culpa exercitationem, maiores non soluta veniam voluptatibus! Accusamus aspernatur beatae cum dolorem ea eum
            eveniet magnam modi porro voluptates.
        </div>
        <div>At consequuntur eveniet modi officiis. Ad corporis cupiditate eius hic impedit laboriosam officiis qui
            quos. Aspernatur, assumenda autem culpa est ex hic necessitatibus numquam, omnis possimus provident
            recusandae sed, voluptate?
        </div>
        <div>Assumenda at dicta ducimus eaque est eum, id inventore ipsum iure iusto maxime mollitia nisi nulla possimus
            quas repellendus ut. Architecto autem dolore doloribus ea modi, nobis pariatur veritatis voluptatum?
        </div></div>
    <script>
        class FPS{
            constructor(){
                this.width=150;
                this.height=65;

                this.canvas=document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.classList.add("fps_draw");
                this.canvas.width=this.width;
                this.canvas.height=this.height;
                document.body.appendChild(this.canvas);
                this.ctx.font="bold 16px Arial";
                var that=this;
                //метод, который ставит на паузу или возобновляет работу при нажатии на canvas
                this.canvas.addEventListener('click',function () {
                    that.staypause();
                });

                this.hidden=true;
                this.startTime=0;
                this.frame=0;

                this.allFPS=[];
                this.playing=false;

                this.perf=(performance || Date);
            }
            //поставить на паузу
            staypause(){
                this.playing = this.playing ? false : true;
                if (this.playing) this.loop();
            }
            //вкл/выкл
            toggle(){
                this.hidden = this.hidden ? false : true;
                if(!this.hidden) {
                    this.canvas.classList.add("is_visible");
                    this.loop();
                }else{
                    this.canvas.classList.remove("is_visible");
                }
            }
            loop() {
                if(this.hidden || !this.playing) return false;
                var that=this;
                window.requestAnimationFrame(function () {
                    that.draw();
                    that.loop();
                });
            }
            add(x){
                this.allFPS.unshift(x);
                //последние 150 значений FPS
                this.allFPS=this.allFPS.slice(0,this.width);
            }
            draw(){
                var currentFPS=this.getFPS();
                this.add(currentFPS);
                //очистить прямоугольник
                this.ctx.clearRect(0,0,this.width,this.height);
                //фоновый цвет
                this.ctx.fillStyle="#000000";
                //отрисовка fps
                for (var i=0; i<=this.width;i++) {
                    this.ctx.fillRect(i, 0, 1,5+ 60-this.allFPS[i]);
                }
                this.ctx.fillText(currentFPS+" fps",22,52);//отрисовка тени для текста
                this.ctx.fillStyle="#ffffff";
                for (var i=0; i<=this.width;i++) {
                    //отрисовка белой линии
                    this.ctx.fillRect(i,5+60-this.allFPS[i],1,2);
                }
                //вывод fps текстом
                this.ctx.fillText(currentFPS+" fps",20,50);
            }
            getFPS(){
                this.frame++;
                var d=this.perf.now();
                this.currentTime = (d - this.startTime)/1000;
                var result = Math.floor(this.frame/this.currentTime);
                if(this.currentTime>1){
                    this.startTime=this.perf.now();
                    this.frame=0;
                }
                return result;
            }
        }

        var fps = new FPS;
        fps.toggle();
        fps.staypause();
    </script>
</body>
</html>